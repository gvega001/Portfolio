@page "/resume"
@using System.Text.Json.Serialization
@using System.Net.Http
@using System.Text.Json
@inject NavigationManager Navigation

<PageTitle>Resume</PageTitle>

<!-- FontAwesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

<!-- Bootstrap CSS (if not already globally loaded) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<!-- Custom Styles -->
<style>
    /* Hero Section Enhancements */
    .hero-section {
        background: linear-gradient(135deg, #6366F1, #A78BFA);
        color: #fff;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

        .hero-section h1 {
            animation: fadeInDown 1s ease-out;
        }

        .hero-section p {
            animation: fadeInUp 1s ease-out;
        }
    @@keyframes fadeInDown {
        from

    {
        opacity: 0;
        transform: translateY(-20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }
    @@keyframes fadeInUp {
        from

    {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    /* Card Enhancements */
    .card {
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease;
    }

        .card:hover {
            box-shadow: 0 0 20px rgba(0,0,0,0.15);
        }

    /* Button Enhancements */
    .btn {
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

        .btn:hover {
            transform: translateY(-2px);
        }
</style>

<!-- Hero Section -->
<div class="hero-section d-flex align-items-center text-center mb-5" style="min-height: 40vh;">
    <div class="container">
        <h1 class="display-3 fw-bold"><i class="fas fa-file-alt"></i> Resume</h1>
        <p class="lead mt-3">An overview of my professional journey and skills.</p>
    </div>
</div>

<!-- Main Resume Content -->
<div class="container my-5">
    <!-- Basics Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h2 class="card-title fw-bold">@resume?.Basics?.Name</h2>
                    <h4 class="card-subtitle mb-2 text-muted">@resume?.Basics?.Label</h4>
                    <p class="card-text">@resume?.Basics?.Summary</p>
                    <p><strong>Email:</strong> @resume?.Basics?.Email</p>
                    <p><strong>Phone:</strong> @resume?.Basics?.Phone</p>
                    <p><strong>Website:</strong> @resume?.Basics?.Website</p>
                    <p>
                        <strong>Location:</strong>
                        @resume?.Basics?.Location?.Address,
                        @resume?.Basics?.Location?.City,
                        @resume?.Basics?.Location?.Region,
                        @resume?.Basics?.Location?.CountryCode,
                        @resume?.Basics?.Location?.PostalCode
                    </p>
                    <div>
                        <strong>Profiles:</strong>
                        <ul class="list-inline">
                            @if (resume?.Basics?.Profiles != null)
                            {
                                foreach (var profile in resume.Basics.Profiles)
                                {
                                    <li class="list-inline-item">
                                        <a href="@profile.Url" target="_blank">
                                            <i class="fab fa-@profile.Network.ToLower()"></i> @profile.Username
                                        </a>
                                    </li>
                                }
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid of Resume Sections -->
    <div class="row row-cols-1 row-cols-md-2 g-4">
        <!-- Work Experience -->
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h3 class="card-title fw-bold">Work Experience</h3>
                    @if (resume?.Work != null && resume.Work.Any())
                    {
                        foreach (var work in resume.Work)
                        {
                            <div class="mb-3">
                                <h5>@work.Position at @work.Name</h5>
                                <p>@work.Summary</p>
                                <p>
                                    <small>
                                        <strong>From:</strong> @work.StartDate.ToShortDateString() -
                                        @(work.EndDate.HasValue ? work.EndDate.Value.ToShortDateString() : "Present")
                                    </small>
                                </p>
                            </div>
                        }
                    }
                    else
                    {
                        <p>No work experience available.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Education -->
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h3 class="card-title fw-bold">Education</h3>
                    @if (resume?.Education != null && resume.Education.Any())
                    {
                        foreach (var edu in resume.Education)
                        {
                            <div class="mb-3">
                                <h5>@edu.Institution</h5>
                                <p>@edu.Area - @edu.StudyType</p>
                                <p>
                                    <small>
                                        <strong>From:</strong> @edu.StartDate.ToShortDateString() -
                                        @(edu.EndDate.HasValue ? edu.EndDate.Value.ToShortDateString() : "Present")
                                    </small>
                                </p>
                            </div>
                        }
                    }
                    else
                    {
                        <p>No education details available.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Skills -->
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h3 class="card-title fw-bold">Skills</h3>
                    @if (resume?.Skills != null && resume.Skills.Any())
                    {
                        foreach (var skill in resume.Skills)
                        {
                            <p><strong>@skill.Name:</strong> @string.Join(", ", skill.Keywords)</p>
                        }
                    }
                    else
                    {
                        <p>No skills listed.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Projects -->
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h3 class="card-title fw-bold">Projects</h3>
                    @if (resume?.Projects != null && resume.Projects.Any())
                    {
                        foreach (var proj in resume.Projects)
                        {
                            <div class="mb-3">
                                <h5>@proj.Name</h5>
                                <p>@proj.Summary</p>
                                <p>
                                    <small>Started on: @proj.StartDate.ToShortDateString()</small>
                                </p>
                            </div>
                        }
                    }
                    else
                    {
                        <p>No projects available.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Certifications -->
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h3 class="card-title fw-bold">Certifications</h3>
                    @if (resume?.Certifications != null && resume.Certifications.Any())
                    {
                        foreach (var cert in resume.Certifications)
                        {
                            <p>
                                <strong>@cert.Name</strong> by @cert.Issuer on @cert.Date.ToShortDateString()
                            </p>
                        }
                    }
                    else
                    {
                        <p>No certifications listed.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Languages -->
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h3 class="card-title fw-bold">Languages</h3>
                    @if (resume?.Languages != null && resume.Languages.Any())
                    {
                        foreach (var lang in resume.Languages)
                        {
                            <p><strong>@lang.Name:</strong> @lang.Fluency</p>
                        }
                    }
                    else
                    {
                        <p>No language information available.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Interests -->
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h3 class="card-title fw-bold">Interests</h3>
                    @if (resume?.Interests != null && resume.Interests.Any())
                    {
                        foreach (var interest in resume.Interests)
                        {
                            <p><strong>@interest.Name:</strong> @string.Join(", ", interest.Keywords)</p>
                        }
                    }
                    else
                    {
                        <p>No interests listed.</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Custom JavaScript for Additional Effects -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Animate cards on page load
        var cards = document.querySelectorAll(".card");
        cards.forEach(function(card) {
            card.style.opacity = 0;
            setTimeout(function() {
                card.style.transition = "opacity 0.5s ease-in-out";
                card.style.opacity = 1;
            }, 200);
        });
    });
</script>

@code {
    private ResumeModel? resume;
    private bool showChatbot = false;
    private string userCode = "";
    private string codeOutput = "";
    private string randomQuote = "Technology is best when it brings people together.";

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var baseAddress = new Uri(Navigation.BaseUri);
            using var httpClient = new HttpClient { BaseAddress = baseAddress };
            var json = await httpClient.GetStringAsync("resume.json"); // Ensure resume.json is in wwwroot

            var options = new JsonSerializerOptions { PropertyNameCaseInsensitive = true };
            options.Converters.Add(new NullableDateTimeConverter());

            resume = JsonSerializer.Deserialize<ResumeModel>(json, options);
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Error loading resume: {ex.Message}");
        }
    }

    public class NullableDateTimeConverter : JsonConverter<DateTime?>
    {
        public override DateTime? Read(ref Utf8JsonReader reader, Type typeToConvert, JsonSerializerOptions options)
        {
            if (reader.TokenType == JsonTokenType.String)
            {
                var str = reader.GetString();
                if (string.IsNullOrWhiteSpace(str) || str.Equals("Present", StringComparison.OrdinalIgnoreCase))
                {
                    return null;
                }
                if (DateTime.TryParse(str, out DateTime dt))
                {
                    return dt;
                }
                throw new JsonException($"Unable to parse '{str}' as DateTime.");
            }
            else if (reader.TokenType == JsonTokenType.Null)
            {
                return null;
            }
            throw new JsonException($"Unexpected token parsing date. Token: {reader.TokenType}");
        }

        public override void Write(Utf8JsonWriter writer, DateTime? value, JsonSerializerOptions options)
        {
            if (value.HasValue)
                writer.WriteStringValue(value.Value.ToString("yyyy-MM-dd"));
            else
                writer.WriteNullValue();
        }
    }

    [Serializable]
    public class ResumeModel
    {
        [JsonPropertyName("basics")]
        public Basics? Basics { get; set; }
        [JsonPropertyName("work")]
        public List<Work>? Work { get; set; }
        [JsonPropertyName("education")]
        public List<Education> Education { get; set; }
        [JsonPropertyName("skills")]
        public List<Skill> Skills { get; set; }
        [JsonPropertyName("projects")]
        public List<Project> Projects { get; set; }
        [JsonPropertyName("certifications")]
        public List<Certification> Certifications { get; set; }
        [JsonPropertyName("languages")]
        public List<Language> Languages { get; set; }
        [JsonPropertyName("interests")]
        public List<Interest> Interests { get; set; }
    }

    [Serializable]
    public class Basics
    {
        [JsonPropertyName("name")]
        public string Name { get; set; }
        [JsonPropertyName("label")]
        public string Label { get; set; }
        [JsonPropertyName("picture")]
        public string Picture { get; set; }
        [JsonPropertyName("phone")]
        public string Phone { get; set; }
        [JsonPropertyName("email")]
        public string Email { get; set; }
        [JsonPropertyName("website")]
        public string Website { get; set; }
        [JsonPropertyName("summary")]
        public string Summary { get; set; }
        [JsonPropertyName("location")]
        public Location Location { get; set; }
        [JsonPropertyName("profiles")]
        public List<Profile> Profiles { get; set; }
    }

    public class Location
    {
        public string Address { get; set; }
        public string PostalCode { get; set; }
        public string City { get; set; }
        public string CountryCode { get; set; }
        public string Region { get; set; }
    }

    public class Profile
    {
        public string Network { get; set; }
        public string Username { get; set; }
        public string Url { get; set; }
    }

    public class Work
    {
        public string Name { get; set; }
        public string Position { get; set; }
        public DateTime StartDate { get; set; }
        public DateTime? EndDate { get; set; }
        public string Summary { get; set; }
    }

    public class Education
    {
        public string Institution { get; set; }
        public string Area { get; set; }
        public string StudyType { get; set; }
        public DateTime StartDate { get; set; }
        [JsonConverter(typeof(NullableDateTimeConverter))]
        public DateTime? EndDate { get; set; }
    }

    public class Skill
    {
        public string Name { get; set; }
        public List<string> Keywords { get; set; }
    }

    public class Project
    {
        public string Name { get; set; }
        public DateTime StartDate { get; set; }
        public string Summary { get; set; }
    }

    public class Certification
    {
        public string Name { get; set; }
        public DateTime Date { get; set; }
        public string Issuer { get; set; }
    }

    public class Language
    {
        [JsonPropertyName("language")]
        public string Name { get; set; }
        public string Fluency { get; set; }
    }

    public class Interest
    {
        public string Name { get; set; }
        public List<string> Keywords { get; set; }
    }

    private void ToggleChatbot() => showChatbot = !showChatbot;
    private void GenerateQuote() => randomQuote = new[]
    {
        "Code is like humor. When you have to explain it, it’s bad.",
        "Fix the cause, not the symptom.",
        "Optimism is an occupational hazard of programming."
    }[new Random().Next(3)];
    private void RunCode() => codeOutput = userCode.Contains("Hello")
        ? "Output: Hello, world!"
        : "Simulated output.";
}
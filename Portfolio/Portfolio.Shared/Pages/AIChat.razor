@page "/aichat"

<PageTitle>AI Chat</PageTitle>

<!-- Hero Section -->
<div class="hero-section d-flex align-items-center mb-5"
     style="min-height: 40vh; background: linear-gradient(135deg, #6366F1, #A78BFA);">
    <div class="container text-white text-center">
        <h1 class="display-3 fw-bold">AI Chat</h1>
        <p class="lead mt-3">
            Interact with my custom GPT-based chatbot—enter a prompt and see the AI respond!
        </p>
    </div>
</div>

<div class="container mb-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Card for Prompt Input -->
            <div class="card border border-2 border-secondary mb-4">
                <div class="card-body">
                    <h4 class="card-title fw-bold">Ask the AI</h4>
                    <p class="card-text">
                        Type your question or command below, then click Send.
                    </p>
                    <div class="mb-3">
                        <textarea class="form-control" @bind="UserPrompt" rows="3"
                                  placeholder="Type your question here..."></textarea>
                    </div>
                    <button class="btn btn-primary" @onclick="SendChat">
                        <i class="bi bi-chat-dots"></i> Send
                    </button>
                </div>
            </div>

            <!-- Card for AI Response -->
            @if (!string.IsNullOrEmpty(AIResponse))
            {
                <div class="card border border-2 border-secondary">
                    <div class="card-body">
                        <h4 class="card-title fw-bold">AI says:</h4>
                        <p>@AIResponse</p>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private string UserPrompt = string.Empty;
    private const string BaseUrl = "https://localhost:5001"; // change if needed
    private string? AIResponse;

    private async Task SendChat()
    {
        try
        {
            var url = $"{BaseUrl}/api/ai/chat?prompt={Uri.EscapeDataString(UserPrompt)}";

            using var client = new HttpClient();
            var result = await client.GetFromJsonAsync<AIResult>(url);
            AIResponse = result?.Response;
        }
        catch (Exception ex)
        {
            AIResponse = $"Error: {ex.Message}";
        }
    }

    private class AIResult
    {
        public string? Response { get; set; }
    }
}
